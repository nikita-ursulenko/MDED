{% block content %}
    <section id="beneficiari" class="py-20 bg-gray-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16">
                {% set main_title = function('get_field', 'beneficiaries_main_title') %}
                {% if main_title %}
                    <h2 class="text-5xl font-bold text-gray-900 mb-8">{{ main_title }}</h2>
                {% endif %}

                {% set main_description = function('get_field', 'beneficiaries_main_description') %}
                {% if main_description %}
                    <div class="text-xl text-gray-600 max-w-4xl mx-auto">{{ main_description|raw }}</div> {# Use |raw because new_lines is wpautop #}
                {% endif %}
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                {# Card 1: Companii naționale #}
                {% set card1_title = function('get_field', 'beneficiaries_card1_title') %}
                {% set card1_short_desc = function('get_field', 'beneficiaries_card1_short_desc') %}
                {% set card1_extended_title = function('get_field', 'beneficiaries_card1_extended_title') %}
                {% set card1_point1 = function('get_field', 'beneficiaries_card1_point1') %}
                {% set card1_point2 = function('get_field', 'beneficiaries_card1_point2') %}
                {% set card1_point3 = function('get_field', 'beneficiaries_card1_point3') %}
                {% set card1_point4 = function('get_field', 'beneficiaries_card1_point4') %}

                {% if card1_title or card1_short_desc or card1_extended_title or card1_point1 %} {# Check if at least one field is set to render the card #}
                    <div class="relative bg-white rounded-xl p-8 hover:shadow-xl transition-all duration-300 cursor-pointer group border-2 border-transparent hover:border-gov-blue overflow-hidden" onclick="toggleCard(1, event)">
                        <div class="w-20 h-20 bg-gov-light-blue rounded-full flex items-center justify-center mx-auto mb-6 group-hover:bg-gov-blue group-hover:text-white transition-colors">
                            <svg class="w-10 h-10" fill="currentColor" viewbox="0 0 20 20">
                                <path d="M4 3a2 2 0 100 4h12a2 2 0 100-4H4z"/>
                                <path fill-rule="evenodd" d="M3 8h14v7a2 2 0 01-2 2H5a2 2 0 01-2-2V8zm5 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        {% if card1_title %}<h3 class="text-2xl font-bold text-center mb-4 text-gov-blue">{{ card1_title }}</h3>{% endif %}
                        {% if card1_short_desc %}<p class="text-gray-600 text-center text-base leading-relaxed" id="short-desc-1">{{ card1_short_desc|raw }}</p>{% endif %}

                        <div class="absolute inset-0 bg-gov-light-blue rounded-xl p-8 flex flex-col justify-center items-start text-gov-blue transition-all duration-300 transform scale-95 opacity-0 pointer-events-none z-10" id="extended-desc-1">
                            {% if card1_extended_title %}<h4 class="font-semibold mb-3 text-2xl">{{ card1_extended_title }}</h4>{% endif %}
                            <ul class="text-base space-y-3">
                                {% if card1_point1 %}
                                    <li class="flex items-start space-x-2">
                                        <span class="w-2 h-2 bg-gov-blue rounded-full mt-2 flex-shrink-0"></span>
                                        <span>{{ card1_point1 }}</span>
                                    </li>
                                {% endif %}
                                {% if card1_point2 %}
                                    <li class="flex items-start space-x-2">
                                        <span class="w-2 h-2 bg-gov-blue rounded-full mt-2 flex-shrink-0"></span>
                                        <span>{{ card1_point2 }}</span>
                                    </li>
                                {% endif %}
                                {% if card1_point3 %}
                                    <li class="flex items-start space-x-2">
                                        <span class="w-2 h-2 bg-gov-blue rounded-full mt-2 flex-shrink-0"></span>
                                        <span>{{ card1_point3 }}</span>
                                    </li>
                                {% endif %}
                                {% if card1_point4 %}
                                    <li class="flex items-start space-x-2">
                                        <span class="w-2 h-2 bg-gov-blue rounded-full mt-2 flex-shrink-0"></span>
                                        <span>{{ card1_point4 }}</span>
                                    </li>
                                {% endif %}
                            </ul>
                            <button class="absolute top-4 right-4 text-gov-blue hover:text-gov-blue-dark" onclick="event.stopPropagation(); toggleCard(1, event);">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                {% endif %}

                {# Card 2: Investitori internaționali #}
                {% set card2_title = function('get_field', 'beneficiaries_card2_title') %}
                {% set card2_short_desc = function('get_field', 'beneficiaries_card2_short_desc') %}
                {% set card2_extended_title = function('get_field', 'beneficiaries_card2_extended_title') %}
                {% set card2_point1 = function('get_field', 'beneficiaries_card2_point1') %}
                {% set card2_point2 = function('get_field', 'beneficiaries_card2_point2') %}
                {% set card2_point3 = function('get_field', 'beneficiaries_card2_point3') %}
                {% set card2_point4 = function('get_field', 'beneficiaries_card2_point4') %}

                {% if card2_title or card2_short_desc or card2_extended_title or card2_point1 %}
                    <div class="relative bg-white rounded-xl p-8 hover:shadow-xl transition-all duration-300 cursor-pointer group border-2 border-transparent hover:border-gov-blue overflow-hidden" onclick="toggleCard(2, event)">
                        <div class="w-20 h-20 bg-gov-light-blue rounded-full flex items-center justify-center mx-auto mb-6 group-hover:bg-gov-blue group-hover:text-white transition-colors">
                            <svg class="w-10 h-10" fill="currentColor" viewbox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM4.332 8.027a6.012 6.012 0 011.912-2.706C6.512 5.73 6.974 6 7.5 6A1.5 1.5 0 019 7.5V8a2 2 0 004 0 2 2 0 011.523-1.943A5.977 5.977 0 0116 10c0 .34-.028.675-.083 1H15a2 2 0 00-2 2v2.197A5.973 5.973 0 0110 16v-2a2 2 0 00-2-2 2 2 0 01-2-2 2 2 0 00-1.668-1.973z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        {% if card2_title %}<h3 class="text-2xl font-bold text-center mb-4 text-gov-blue">{{ card2_title }}</h3>{% endif %}
                        {% if card2_short_desc %}<p class="text-gray-600 text-center text-base leading-relaxed" id="short-desc-2">{{ card2_short_desc|raw }}</p>{% endif %}

                        <div class="absolute inset-0 bg-gov-light-blue rounded-xl p-8 flex flex-col justify-center items-start text-gov-blue transition-all duration-300 transform scale-95 opacity-0 pointer-events-none z-10" id="extended-desc-2">
                            {% if card2_extended_title %}<h4 class="font-semibold mb-3 text-2xl">{{ card2_extended_title }}</h4>{% endif %}
                            <ul class="text-base space-y-3">
                                {% if card2_point1 %}
                                    <li class="flex items-start space-x-2">
                                        <span class="w-2 h-2 bg-gov-blue rounded-full mt-2 flex-shrink-0"></span>
                                        <span>{{ card2_point1 }}</span>
                                    </li>
                                {% endif %}
                                {% if card2_point2 %}
                                    <li class="flex items-start space-x-2">
                                        <span class="w-2 h-2 bg-gov-blue rounded-full mt-2 flex-shrink-0"></span>
                                        <span>{{ card2_point2 }}</span>
                                    </li>
                                {% endif %}
                                {% if card2_point3 %}
                                    <li class="flex items-start space-x-2">
                                        <span class="w-2 h-2 bg-gov-blue rounded-full mt-2 flex-shrink-0"></span>
                                        <span>{{ card2_point3 }}</span>
                                    </li>
                                {% endif %}
                                {% if card2_point4 %}
                                    <li class="flex items-start space-x-2">
                                        <span class="w-2 h-2 bg-gov-blue rounded-full mt-2 flex-shrink-0"></span>
                                        <span>{{ card2_point4 }}</span>
                                    </li>
                                {% endif %}
                            </ul>
                            <button class="absolute top-4 right-4 text-gov-blue hover:text-gov-blue-dark" onclick="event.stopPropagation(); toggleCard(2, event);">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                {% endif %}

                {# Card 3: Diaspora #}
                {% set card3_title = function('get_field', 'beneficiaries_card3_title') %}
                {% set card3_short_desc = function('get_field', 'beneficiaries_card3_short_desc') %}
                {% set card3_extended_title = function('get_field', 'beneficiaries_card3_extended_title') %}
                {% set card3_point1 = function('get_field', 'beneficiaries_card3_point1') %}
                {% set card3_point2 = function('get_field', 'beneficiaries_card3_point2') %}
                {% set card3_point3 = function('get_field', 'beneficiaries_card3_point3') %}
                {% set card3_point4 = function('get_field', 'beneficiaries_card3_point4') %}

                {% if card3_title or card3_short_desc or card3_extended_title or card3_point1 %}
                    <div class="relative bg-white rounded-xl p-8 hover:shadow-xl transition-all duration-300 cursor-pointer group border-2 border-transparent hover:border-gov-blue overflow-hidden" onclick="toggleCard(3, event)">
                        <div class="w-20 h-20 bg-gov-light-blue rounded-full flex items-center justify-center mx-auto mb-6 group-hover:bg-gov-blue group-hover:text-white transition-colors">
                            <svg class="w-10 h-10" fill="currentColor" viewbox="0 0 20 20">
                                <path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3zM3.31 9.397L5 10.12v4.102a8.969 8.969 0 00-1.05-.174 1 1 0 01-.89-.89 11.115 11.115 0 01.25-3.762zM9.3 16.573A9.026 9.026 0 007 14.935v-3.957l1.818.78a3 3 0 002.364 0l5.508-2.361a11.026 11.026 0 01.25 3.762 1 1 0 01-.89.89 8.968 8.968 0 00-5.35 2.524 1 1 0 01-1.4 0zM6 18a1 1 0 001-1v-2.065a8.935 8.935 0 00-2-.712V17a1 1 0 001 1z"/>
                            </svg>
                        </div>
                        {% if card3_title %}<h3 class="text-2xl font-bold text-center mb-4 text-gov-blue">{{ card3_title }}</h3>{% endif %}
                        {% if card3_short_desc %}<p class="text-gray-600 text-center text-base leading-relaxed" id="short-desc-3">{{ card3_short_desc|raw }}</p>{% endif %}

                        <div class="absolute inset-0 bg-gov-light-blue rounded-xl p-8 flex flex-col justify-center items-start text-gov-blue transition-all duration-300 transform scale-95 opacity-0 pointer-events-none z-10" id="extended-desc-3">
                            {% if card3_extended_title %}<h4 class="font-semibold mb-3 text-2xl">{{ card3_extended_title }}</h4>{% endif %}
                            <ul class="text-base space-y-3">
                                {% if card3_point1 %}
                                    <li class="flex items-start space-x-2">
                                        <span class="w-2 h-2 bg-gov-blue rounded-full mt-2 flex-shrink-0"></span>
                                        <span>{{ card3_point1 }}</span>
                                    </li>
                                {% endif %}
                                {% if card3_point2 %}
                                    <li class="flex items-start space-x-2">
                                        <span class="w-2 h-2 bg-gov-blue rounded-full mt-2 flex-shrink-0"></span>
                                        <span>{{ card3_point2 }}</span>
                                    </li>
                                {% endif %}
                                {% if card3_point3 %}
                                    <li class="flex items-start space-x-2">
                                        <span class="w-2 h-2 bg-gov-blue rounded-full mt-2 flex-shrink-0"></span>
                                        <span>{{ card3_point3 }}</span>
                                    </li>
                                {% endif %}
                                {% if card3_point4 %}
                                    <li class="flex items-start space-x-2">
                                        <span class="w-2 h-2 bg-gov-blue rounded-full mt-2 flex-shrink-0"></span>
                                        <span>{{ card3_point4 }}</span>
                                    </li>
                                {% endif %}
                            </ul>
                            <button class="absolute top-4 right-4 text-gov-blue hover:text-gov-blue-dark" onclick="event.stopPropagation(); toggleCard(3, event);">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </section>
    {# The JavaScript part remains unchanged as it directly manipulates the DOM elements by their IDs #}
    <script>
        // Global variable to keep track of the currently open card
let openCardNum = null;

function toggleCard(num, event = null) { // Prevent event bubbling if clicked on an inner element that should close the card
if (event) {
event.stopPropagation();
}

const card = document.querySelector (`.md\\:grid-cols-3 > div:nth-child(${num})`);
if (! card)
return;


const extendedDesc = document.getElementById (`extended-desc-${num}`);
if (! extendedDesc)
return;


// Close the currently open card if it's different from the clicked one
if (openCardNum !== null && openCardNum !== num) {
const prevExtendedDesc = document.getElementById (`extended-desc-${openCardNum}`);
if (prevExtendedDesc) {
prevExtendedDesc.classList.add('scale-95', 'opacity-0', 'pointer-events-none');
prevExtendedDesc.classList.remove('scale-100', 'opacity-100', 'pointer-events-auto');
}
}

// Toggle the clicked card
if (extendedDesc.classList.contains('opacity-0')) { // Open the card
extendedDesc.classList.remove('scale-95', 'opacity-0', 'pointer-events-none');
extendedDesc.classList.add('scale-100', 'opacity-100', 'pointer-events-auto');
openCardNum = num; // Set the currently open card
} else { // Close the card
extendedDesc.classList.add('scale-95', 'opacity-0', 'pointer-events-none');
extendedDesc.classList.remove('scale-100', 'opacity-100', 'pointer-events-auto');
openCardNum = null; // No card is open
}
}

// Close the card if clicked anywhere outside of any card
document.addEventListener('click', (event) => {
if (openCardNum !== null) {
const openedCardElement = document.getElementById (`extended-desc-${openCardNum}`);
const parentCard = openedCardElement ? openedCardElement.closest('.relative.bg-white') : null;

if (openedCardElement && parentCard && ! parentCard.contains(event.target)) {
toggleCard(openCardNum); // Close the card
}
}
});
    </script>
{% endblock %}