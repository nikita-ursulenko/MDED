{% block content %}
	<section id="beneficiari" class="py-20 bg-gray-50">
		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
			<div class="text-center mb-16">
				{% set main_title = function('get_field', 'beneficiaries_main_title') %}
				{% if main_title %}
					<h2 class="text-5xl font-bold text-gray-900 mb-8">{{ main_title }}</h2>
				{% endif %}

				{% set main_description = function('get_field', 'beneficiaries_main_description') %}
				{% if main_description %}
					<div class="text-xl text-gray-600 max-w-4xl mx-auto">{{ main_description|raw }}</div>
				{% endif %}
			</div>

			<div
				class="grid grid-cols-1 md:grid-cols-3 gap-8">
				{# Macro for rendering a beneficiary card #}
				{% macro beneficiary_card(card_id) %}
					{% set title = function('get_field', 'beneficiaries_card' ~ card_id ~ '_title') %}
					{% set short_desc = function('get_field', 'beneficiaries_card' ~ card_id ~ '_short_desc') %}
					{% set extended_title = function('get_field', 'beneficiaries_card' ~ card_id ~ '_extended_title') %}
					{% set points = [] %}
					{% for i in 1..4 %}
						{% set point = function('get_field', 'beneficiaries_card' ~ card_id ~ '_point' ~ i) %}
						{% if point %}
							{% set points = points|merge([point]) %}
						{% endif %}
					{% endfor %}

					{% if title or short_desc or extended_title or points %}
						<div class="relative bg-white rounded-xl p-8 hover:shadow-xl transition-all duration-300 cursor-pointer group border-2 border-transparent hover:border-gov-blue overflow-hidden card-item" data-card-id="{{ card_id }}">
							<div
								class="w-20 h-20 bg-gov-light-blue rounded-full flex items-center justify-center mx-auto mb-6 group-hover:bg-gov-blue group-hover:text-white transition-colors">
								{# SVG icon can be dynamic or static depending on your needs #}
								{% if card_id == 1 %}
									<svg class="w-10 h-10" fill="currentColor" viewbox="0 0 20 20">
										<path d="M4 3a2 2 0 100 4h12a2 2 0 100-4H4z"/>
										<path fill-rule="evenodd" d="M3 8h14v7a2 2 0 01-2 2H5a2 2 0 01-2-2V8zm5 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" clip-rule="evenodd"/>
									</svg>
								{% elseif card_id == 2 %}
									<svg class="w-10 h-10" fill="currentColor" viewbox="0 0 20 20">
										<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM4.332 8.027a6.012 6.012 0 011.912-2.706C6.512 5.73 6.974 6 7.5 6A1.5 1.5 0 019 7.5V8a2 2 0 004 0 2 2 0 011.523-1.943A5.977 5.977 0 0116 10c0 .34-.028.675-.083 1H15a2 2 0 00-2 2v2.197A5.973 5.973 0 0110 16v-2a2 2 0 00-2-2 2 2 0 01-2-2 2 2 0 00-1.668-1.973z" clip-rule="evenodd"/>
									</svg>
								{% elseif card_id == 3 %}
									<svg class="w-10 h-10" fill="currentColor" viewbox="0 0 20 20">
										<path d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3zM3.31 9.397L5 10.12v4.102a8.969 8.969 0 00-1.05-.174 1 1 0 01-.89-.89 11.115 11.115 0 01.25-3.762zM9.3 16.573A9.026 9.026 0 007 14.935v-3.957l1.818.78a3 3 0 002.364 0l5.508-2.361a11.026 11.026 0 01.25 3.762 1 1 0 01-.89.89 8.968 8.968 0 00-5.35 2.524 1 1 0 01-1.4 0zM6 18a1 1 0 001-1v-2.065a8.935 8.935 0 00-2-.712V17a1 1 0 001 1z"/>
									</svg>
								{% endif %}
							</div>
							{% if title %}
								<h3 class="text-2xl font-bold text-center mb-4 text-gov-blue">{{ title }}</h3>
							{% endif %}
							{% if short_desc %}
								<p class="text-gray-600 text-center text-base leading-relaxed short-desc">{{ short_desc|raw }}</p>
							{% endif %}

							<div class="absolute inset-0 bg-gov-light-blue rounded-xl p-8 flex flex-col justify-center items-start text-gov-blue transition-all duration-300 transform md:scale-95 md:opacity-0 md:pointer-events-none group-hover:scale-100 group-hover:opacity-100 group-hover:pointer-events-auto extended-desc" data-card-id="{{ card_id }}">
								{% if extended_title %}
									<h4 class="font-semibold mb-3 text-2xl">{{ extended_title }}</h4>
								{% endif %}
								<ul class="text-base space-y-3">
									{% for point in points %}
										<li class="flex items-start space-x-2">
											<span class="w-2 h-2 bg-gov-blue rounded-full mt-2 flex-shrink-0"></span>
											<span>{{ point }}</span>
										</li>
									{% endfor %}
								</ul>
							</div>
						</div>
					{% endif %}
				{% endmacro %}

				{{ _self.beneficiary_card(1) }}
				{{ _self.beneficiary_card(2) }}
				{{ _self.beneficiary_card(3) }}
			</div>
		</div>
	</section>

	---

	<script>
		document.addEventListener('DOMContentLoaded', () => {
const cardItems = document.querySelectorAll('.card-item');
let openCard = null; // To keep track of the currently open card on mobile
const isMobile = () => window.innerWidth < 768; // Helper for media query check

const toggleCardVisibility = (cardElement, show) => {
const extendedDesc = cardElement.querySelector('.extended-desc');
if (show) {
extendedDesc.classList.remove('scale-95', 'opacity-0', 'pointer-events-none');
extendedDesc.classList.add('scale-100', 'opacity-100', 'pointer-events-auto');
} else {
extendedDesc.classList.add('scale-95', 'opacity-0', 'pointer-events-none');
extendedDesc.classList.remove('scale-100', 'opacity-100', 'pointer-events-auto');
}
};

cardItems.forEach(card => {
const closeButton = card.querySelector('.close-button');

card.addEventListener('click', (event) => {
if (isMobile()) { // If a different card is open, close it
if (openCard && openCard !== card) {
toggleCardVisibility(openCard, false);
}

// Toggle the current card
const shouldOpen = openCard !== card; // If openCard is null or different, we want to open this one
toggleCardVisibility(card, shouldOpen);
openCard = shouldOpen ? card : null;
}
});

if (closeButton) {
closeButton.addEventListener('click', (event) => {
event.stopPropagation(); // Prevent the card's click listener from re-opening it
if (isMobile()) {
toggleCardVisibility(card, false);
openCard = null;
}
});
}
});

// Close the currently open card if clicked anywhere outside of it on mobile
document.addEventListener('click', (event) => {
if (isMobile() && openCard && ! openCard.contains(event.target)) {
toggleCardVisibility(openCard, false);
openCard = null;
}
});
});
	</script>
{% endblock %}
